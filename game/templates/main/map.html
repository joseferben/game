{% extends 'main/base.html' %}

{% load static %}

{% block navigation %}
{% endblock navigation %}

{% block main_title %}
  Laketown
{% endblock main_title %}

{% block main_subtitle %}
  Meadows ({{ player.x }}, {{ player.y }})
{% endblock main_subtitle %}

{% block main_description %}
  To the north you see the sun reflected in big lakes.
{% endblock main_description %}

{% block main_top_content %}
  <!-- Top content -->
  <ul class="flex-grow-1 list-group list-group-flush overflow-auto" style="min-height:35%;">
    {% if tile.description %}
      <div class="p-2 mb-1">
        {{ tile.description }}
      </div>
    {% endif %}
    {% for player in players %}
      <li class="list-group-item"><a href="#">{{ player.user.username }}</a> ({{ player.lavel }})</li>
    {% endfor %}
  </ul>

  <!-- Mini map -->
  <div id="mini-map" class="overflow-hidden">
    {% for row in mini_map.renderable_tiles %}
      <div style="margin-bottom:-6px;" class="d-flex">
        {% for tile in row %}
          <div class="d-flex">
            <form style="
              {% if tile.x < player.x|add:-1 or tile.y < player.y|add:-1 or tile.x > player.x|add:1 or tile.y > player.y|add:1 %}filter: brightness(0.7);{% endif %}
              "
              class="position-relative" action="{% url 'main:walk' %}" method="POST">
              {% csrf_token %}
              <input type="hidden" name="x" value="{{ tile.x }}">
              <input type="hidden" name="y" value="{{ tile.y }}">
              {% for image_path in tile.image_paths reversed %}
                {% if tile.x == player.x and tile.y == player.y %}
                  <img class="position-absolute img-fluid crispy" width="128" height="128" src="{% static player.avatar_path %}" alt="The player's avatar"></img>
                {% endif %}
                {% if forloop.first %}
                  {% if tile.x >= player.x|add:-1 and tile.y >= player.y|add:-1 and tile.x <= player.x|add:1 and tile.y <= player.y|add:1 and tile.obstacle %}
                    <input type="image" name="image" class="{% if tile.image_paths|length > 1 %}position-absolute{% endif %} crispy img-fluid" width="128" height="128" src="{% static image_path %}">
                  {% else %}
                    <img class="{% if tile.image_paths|length > 1 %}position-absolute{% endif %} crispy img-fluid" width="128" height="128" src="{% static image_path %}"/>
                  {% endif %}
                {% elif forloop.last %}
                  <img class="crispy img-fluid" width="128" height="128" src="{% static image_path %}" />
                {% else %}
                  <img class="position-absolute crispy img-fluid" width="128" height="128" src="{% static image_path %}"/>
                {% endif %}
              {% endfor %}
            </form>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>
{% endblock main_top_content %}
